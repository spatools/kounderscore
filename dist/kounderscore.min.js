!function(a,b){"function"==typeof define&&define.amd?define(["exports","knockout","underscore"],b):"object"==typeof exports?b(exports,require("knockout"),require("underscore")):(a.ko_={},b(a.ko_,a.ko,a._))}(this,function(a,b,c){function d(c){b.utils.extend(c,a.collections)}function e(c){b.utils.extend(c,a.collections)}var f=Array.prototype;c.mixin({sum:function(a,b,d){var e=0;return c.each(a,function(){e+=b.apply(d,arguments)}),e},average:function(a,b,d){return 0===a.length?0:c.sum(a,b,d)/a.length},count:function(a,b,d){return b?c.filter(a,b,d).length:c.size(a)},filterMap:function(a,b,d){var e=[];return c.each(a,function(){var a=b.apply(d,arguments);a&&e.push(a)}),e},index:function(a,b,d){var e=-1;return c.find(a,function(a,c){return b.apply(d,arguments)===!0?(e=c,!0):!1}),e},partialEnd:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(){return a.apply(this,f.slice.call(arguments).concat(b))}}}),a.objects={},a.collections={},c.each(["keys","values","clone","isEmpty"],function(d){a.objects["_"+d]=function(){var a=arguments;return b.computed(function(){return this[d].apply(this,a)},this)},a.objects[d]=function(){return f.unshift.call(arguments,this()),c[d].apply(c,arguments)}}),c.each(["each","map","filterMap","reduce","find","filter","reject","sum","average","all","any","contains","max","min","sortBy","groupBy","toArray","count","size","index"],function(d){a.collections["_"+d]=function(){var a=arguments;return b.computed(function(){return this[d].apply(this,a)},this)},a.collections[d]=function(){return f.unshift.call(arguments,this()),c[d].apply(c,arguments)}}),c.each(["first","initial","last","rest","compact","flatten","without","union","intersection","difference","uniq","zip","indexOf","lastIndexOf"],function(d){a.collections["_"+d]=function(){var a=arguments;return b.computed(function(){return this[d].apply(this,a)},this)},a.collections[d]=function(){var a=this();return f.unshift.call(arguments,c.isArray(a)?a:c.values(a)),c[d].apply(c,arguments)}}),a.addToSubscribable=d,a.addToPrototype=e,b.utils.extend(b.observableArray.fn,a.collections)});